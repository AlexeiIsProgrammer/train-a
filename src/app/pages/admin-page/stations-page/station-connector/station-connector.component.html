@let control = connectionForm.controls;

<!-- Mode Button toggles -->
<ng-container [formGroup]="connectionForm">
    <mat-button-toggle-group
        appearance="legacy"
        name="fontStyle"
        aria-label="Font Style"
        (change)="toggleMode()"
    >
        <mat-button-toggle [checked]="!isEditMode()">Add new</mat-button-toggle>
        <mat-button-toggle>Connect city</mat-button-toggle>
    </mat-button-toggle-group>

    @if (isEditMode()) {
        <!-- Select city -->
        <mat-form-field appearance="outline">
            <mat-label>Select city</mat-label>
            <mat-select
                required="true"
                [value]="selectedStation()"
                (selectionChange)="selectStation($event.value)"
            >
                @for (station of stationList(); track station.id) {
                    <mat-option [value]="station">{{ station.city }}</mat-option>
                }
            </mat-select>
        </mat-form-field>
    } @else {
        <!-- City name input -->
        <mat-form-field appearance="outline">
            <mat-label>City</mat-label>
            <input matInput formControlName="city" />
            <mat-error>{{ control.city.errors | getControlErrorMessage }}</mat-error>
        </mat-form-field>
    }

    <!-- Latitude input -->
    <mat-form-field appearance="outline">
        <mat-label>Latitude</mat-label>
        <input type="number" matInput formControlName="latitude" [readonly]="isEditMode()" />
        <mat-error>{{ control.latitude.errors | getControlErrorMessage }}</mat-error>
    </mat-form-field>

    <!-- Longitude input -->
    <mat-form-field appearance="outline">
        <mat-label>Longitude</mat-label>
        <input type="number" matInput formControlName="longitude" [readonly]="isEditMode()" />
        <mat-error>{{ control.longitude.errors | getControlErrorMessage }}</mat-error>
    </mat-form-field>

    <!-- Connected city list / multiple selector -->
    <mat-form-field appearance="outline">
        <mat-label>Connected city</mat-label>
        <mat-select [multiple]="true" [formControl]="connectedStationControl">
            @for (station of availableStations(); track station.id) {
                <mat-option [value]="station.id">{{ station.city }}</mat-option>
            }
        </mat-select>
        <mat-error>{{ connectedStationControl.errors | getControlErrorMessage }}</mat-error>
    </mat-form-field>
</ng-container>

<button mat-flat-button class="submit-btn" [disabled]="!isFormValid" (click)="submit()">
    {{ isEditMode() ? 'Edit' : 'Add city' }}
</button>
